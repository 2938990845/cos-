<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COS图片上传工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%); min-height: 100vh; padding: 20px; display: flex; justify-content: center; align-items: center; }
        .container { width: 100%; max-width: 800px; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .header { background: #1890ff; color: white; padding: 20px; text-align: center; }
        .main-content { padding: 30px; }
        .section { margin-bottom: 30px; }
        .section-title { font-size: 18px; color: #333; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; display: flex; align-items: center; }
        .section-title i { margin-right: 10px; color: #1890ff; }
        .upload-area { border: 2px dashed #ccc; border-radius: 8px; padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer; transition: all 0.3s; }
        .upload-area:hover { border-color: #1890ff; background: #f9f9f9; }
        .upload-area i { font-size: 48px; color: #1890ff; margin-bottom: 15px; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 500; }
        .input-group input { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; transition: all 0.3s; }
        .input-group input:focus { outline: none; border-color: #1890ff; box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2); }
        .btn-group { display: flex; gap: 15px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; transition: all 0.3s; display: flex; justify-content: center; align-items: center; }
        .btn i { margin-right: 8px; }
        .btn-cancel { background: #f5f5f5; color: #666; }
        .btn-cancel:hover { background: #e6e6e6; }
        .btn-primary { background: #1890ff; color: white; }
        .btn-primary:hover { background: #0c7cd5; }
        .result-area { background: #f9f9f9; border-radius: 8px; padding: 20px; margin-top: 20px; display: none; }
        .result-area h3 { color: #333; margin-bottom: 15px; display: flex; align-items: center; }
        .result-area h3 i { margin-right: 10px; color: #52c41a; }
        .link-item { margin-bottom: 15px; }
        .link-item label { display: block; color: #666; margin-bottom: 5px; font-weight: 500; }
        .link-url { display: flex; align-items: center; background: white; border: 1px solid #eee; border-radius: 4px; padding: 10px 15px; font-size: 14px; color: #1890ff; word-break: break-all; }
        .link-url i { margin-right: 8px; color: #52c41a; }
        .copy-btn { background: #52c41a; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-left: 10px; font-size: 12px; }
        .copy-btn:hover { background: #389e0d; }
        .tip { background: #fffbe6; border: 1px solid #ffe58f; border-radius: 4px; padding: 12px; margin-top: 20px; color: #666; font-size: 14px; }
        .tip i { color: #faad14; margin-right: 8px; }
        .error-area { background: #fff2f0; border: 1px solid #ffccc7; border-radius: 4px; padding: 15px; margin-top: 20px; color: #f5222d; display: none; }
        .error-area i { margin-right: 8px; }
        .config-info { background: #f0f8ff; border-radius: 8px; padding: 15px; margin-top: 30px; }
        .config-info h3 { color: #1890ff; margin-bottom: 10px; display: flex; align-items: center; }
        .config-info h3 i { margin-right: 10px; }
        .config-item { display: flex; margin-bottom: 8px; font-size: 14px; }
        .config-label { color: #666; min-width: 120px; }
        .config-value { color: #333; font-family: monospace; word-break: break-all; }
        #status { color: #f5222d; font-weight: bold; }
        .config-section { margin-bottom: 20px; }
        .progress-bar { height: 6px; background: #f0f0f0; border-radius: 3px; margin-top: 10px; overflow: hidden; }
        .progress { height: 100%; background: #1890ff; width: 0%; transition: width 0.3s; }
        .file-preview { max-width: 100%; max-height: 200px; margin-top: 15px; border-radius: 6px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-file-upload"></i> COS文件上传工具</h1>
        </div>
        
        <div class="main-content">
            <div class="config-section">
                <div class="section-title">
                    <i class="fas fa-cog"></i> COS配置
                </div>
                <div class="input-group">
                    <label for="secretId">SecretId</label>
                    <input type="text" id="secretId" placeholder="请输入SecretId">
                </div>
                <div class="input-group">
                    <label for="secretKey">SecretKey</label>
                    <input type="password" id="secretKey" placeholder="请输入SecretKey">
                </div>
                <div class="input-group">
                    <label for="bucket">Bucket</label>
                    <input type="text" id="bucket" placeholder="格式：example-1250000000">
                </div>
                <div class="input-group">
                    <label for="region">Region</label>
                    <input type="text" id="region" placeholder="例如：ap-beijing">
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="saveConfig">
                        <i class="fas fa-save"></i> 保存配置
                    </button>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-cloud-upload-alt"></i> 上传文件
                    <span id="status" style="margin-left: auto;">未配置</span>
                </div>
                
                <div class="upload-area" id="dropArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>点击选择文件或拖拽文件到此处</p>
                    <input type="file" id="fileInput" style="display: none;">
                    <img id="preview" class="file-preview" alt="文件预览">
                </div>
                
                <div class="input-group">
                    <label for="fileName">自定义文件名（可选）</label>
                    <input type="text" id="fileName" placeholder="留空将使用原始文件名">
                </div>
                
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-cancel" id="cancelBtn">
                        <i class="fas fa-times"></i> 取消
                    </button>
                    <button class="btn btn-primary" id="uploadBtn" disabled>
                        <i class="fas fa-upload"></i> 开始上传
                    </button>
                </div>
            </div>
            
            <div class="result-area" id="resultArea">
                <h3><i class="fas fa-check-circle"></i> 上传成功</h3>
                <div class="link-item">
                    <label>文件URL</label>
                    <div class="link-url">
                        <i class="fas fa-link"></i>
                        <span id="fileUrl"></span>
                        <button class="copy-btn" id="copyUrlBtn">复制</button>
                    </div>
                </div>
                <div class="link-item">
                    <label>Markdown格式</label>
                    <div class="link-url">
                        <i class="fas fa-code"></i>
                        <span id="markdownUrl"></span>
                        <button class="copy-btn" id="copyMdBtn">复制</button>
                    </div>
                </div>
            </div>
            
            <div class="error-area" id="errorArea">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorMsg"></span>
            </div>
            
            <div class="tip">
                <i class="fas fa-info-circle"></i>
                提示：请先配置COS参数，然后选择文件进行上传。支持拖拽上传，上传成功后可以复制文件链接。
            </div>
        </div>
    </div>

    <script>
        // 页面加载时检查是否有保存的配置
        document.addEventListener('DOMContentLoaded', function() {
            const secretId = localStorage.getItem('cos_secretId');
            const secretKey = localStorage.getItem('cos_secretKey');
            const bucket = localStorage.getItem('cos_bucket');
            const region = localStorage.getItem('cos_region');
            
            if (secretId) document.getElementById('secretId').value = secretId;
            if (secretKey) document.getElementById('secretKey').value = secretKey;
            if (bucket) document.getElementById('bucket').value = bucket;
            if (region) document.getElementById('region').value = region;
            
            updateConfigStatus();
        });
        
        // 保存配置
        document.getElementById('saveConfig').addEventListener('click', function() {
            const secretId = document.getElementById('secretId').value;
            const secretKey = document.getElementById('secretKey').value;
            const bucket = document.getElementById('bucket').value;
            const region = document.getElementById('region').value;
            
            if (!secretId || !secretKey || !bucket || !region) {
                showError('请填写完整的配置信息');
                return;
            }
            
            localStorage.setItem('cos_secretId', secretId);
            localStorage.setItem('cos_secretKey', secretKey);
            localStorage.setItem('cos_bucket', bucket);
            localStorage.setItem('cos_region', region);
            
            updateConfigStatus();
            alert('配置已保存！');
        });
        
        // 更新配置状态
        function updateConfigStatus() {
            const statusEl = document.getElementById('status');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (localStorage.getItem('cos_secretId')) {
                statusEl.textContent = '已配置';
                statusEl.style.color = '#52c41a';
                uploadBtn.disabled = false;
            } else {
                statusEl.textContent = '未配置';
                statusEl.style.color = '#f5222d';
                uploadBtn.disabled = true;
            }
        }
        
        // 文件选择处理
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');
        
        dropArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', handleFileSelect);
        
        // 拖拽上传
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.style.borderColor = '#1890ff';
            dropArea.style.backgroundColor = '#f0f7ff';
        });
        
        dropArea.addEventListener('dragleave', () => {
            dropArea.style.borderColor = '#ccc';
            dropArea.style.backgroundColor = '';
        });
        
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.style.borderColor = '#ccc';
            dropArea.style.backgroundColor = '';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileSelect(e);
            }
        });
        
        function handleFileSelect(e) {
            const file = e.target.files[0] || e.dataTransfer.files[0];
            if (!file) return;
            
            // 显示预览
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
            
            // 自动填充文件名
            if (!document.getElementById('fileName').value) {
                document.getElementById('fileName').value = file.name;
            }
        }
        
        // 上传功能
        document.getElementById('uploadBtn').addEventListener('click', function() {
            const file = fileInput.files[0];
            if (!file) {
                showError('请先选择文件');
                return;
            }
            
            // 这里应该是实际的COS上传代码
            // 由于COS SDK需要引入，这里模拟上传过程
            simulateUpload(file);
        });
        
        // 模拟上传过程
        function simulateUpload(file) {
            const progressBar = document.getElementById('progress');
            const uploadBtn = document.getElementById('uploadBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            
            uploadBtn.disabled = true;
            cancelBtn.disabled = true;
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    // 模拟上传完成
                    setTimeout(() => {
                        const fileName = document.getElementById('fileName').value || file.name;
                        const bucket = localStorage.getItem('cos_bucket');
                        const region = localStorage.getItem('cos_region');
                        
                        // 模拟生成URL
                        const fileUrl = `https://${bucket}.cos.${region}.myqcloud.com/${fileName}`;
                        const markdownUrl = `![${fileName}](${fileUrl})`;
                        
                        document.getElementById('fileUrl').textContent = fileUrl;
                        document.getElementById('markdownUrl').textContent = markdownUrl;
                        document.getElementById('resultArea').style.display = 'block';
                        
                        uploadBtn.disabled = false;
                        cancelBtn.disabled = false;
                    }, 300);
                }
                
                progressBar.style.width = progress + '%';
            }, 200);
        }
        
        // 取消上传
        document.getElementById('cancelBtn').addEventListener('click', function() {
            // 重置上传状态
            document.getElementById('progress').style.width = '0%';
            document.getElementById('uploadBtn').disabled = false;
        });
        
        // 复制功能
        document.getElementById('copyUrlBtn').addEventListener('click', function() {
            copyToClipboard(document.getElementById('fileUrl').textContent);
            alert('URL已复制到剪贴板');
        });
        
        document.getElementById('copyMdBtn').addEventListener('click', function() {
            copyToClipboard(document.getElementById('markdownUrl').textContent);
            alert('Markdown链接已复制到剪贴板');
        });
        
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        
        // 错误处理
        function showError(message) {
            const errorArea = document.getElementById('errorArea');
            document.getElementById('errorMsg').textContent = message;
            errorArea.style.display = 'block';
            
            setTimeout(() => {
                errorArea.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
